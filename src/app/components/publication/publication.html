<div class="post-card" (click)="verDetalle(publicacion._id)">
  <img
    class="post-avatar"
    [src]="publicacion.usuario?.profileImage || 'https://i.pravatar.cc/48?img=65'"
    alt="avatar"
  />

  <div class="post-body">
    <div class="post-header">
      <div class="usuario-nombre-fecha">
        <strong>{{ publicacion.usuario?.username || 'Desconocido' }}</strong>
        <span class="post-meta">{{ publicacion.createdAt | date: 'short' }}</span>
        <span *ngIf="publicacion.editado" class="editado">(editado)</span>
      </div>

      <!-- Mini menÃº 3 puntitos -->
      <div class="post-options" *ngIf="esMia()" (click)="toggleMenu($event)">
        â‹®
        <div class="options-menu" *ngIf="menuVisible">
          <button (click)="abrirModalEditarPublicacion(publicacion); $event.stopPropagation()">âœï¸ Editar publicaciÃ³n</button>
          <button (click)="mostrarConfirm($event); $event.stopPropagation()">ğŸ—‘ï¸ Eliminar publicaciÃ³n</button>
        </div>
      </div>
    </div>

    <div *ngIf="esMia()" class="post-badge">Tu publicaciÃ³n</div>

    <div class="post-title" *ngIf="publicacion.titulo">
      <strong>{{ publicacion.titulo }}</strong>
    </div>
    <div class="post-content">{{ publicacion.texto }}</div>

    <img *ngIf="publicacion.imagenUrl" [src]="publicacion.imagenUrl" alt="Imagen publicaciÃ³n" class="post-image" />

    <div class="post-actions">
      <button
        class="btn like-btn"
        [class.liked]="publicacion.liked"
        (click)="publicacion.liked ? quitarLike() : darLike(); $event.stopPropagation()"
      >
        <span class="moon-icon">{{ publicacion.liked ? 'ğŸŒ™' : 'ğŸŒ‘' }}</span>
        <span *ngIf="likesCount() > 0">{{ likesCount() }}</span>
      </button>

      <app-comentarios
        [publicacionId]="publicacion._id"
        [usuarioActualId]="usuarioActualId"
        (click)="$event.stopPropagation()"
      ></app-comentarios>
    </div>

    <label *ngIf="errorMsg" class="error-msg">{{ errorMsg }}</label>
    <label *ngIf="successMsg" class="success-msg">{{ successMsg }}</label>
  </div>
</div>

<!-- Modal ediciÃ³n publicaciÃ³n -->
<div class="modal-overlay" *ngIf="editarPublicacionSeleccionada">
  <div class="edit-modal">
    <h3>Editar publicaciÃ³n</h3>
    <input type="text" [(ngModel)]="publicacionEditadaTitulo" placeholder="TÃ­tulo" class="input-titulo"/>
    <textarea [(ngModel)]="publicacionEditadoTexto" rows="4" placeholder="Texto de la publicaciÃ³n"></textarea>
    <div class="botones-modal">
      <button class="btn btn-guardar" (click)="guardarEdicionPublicacion()">Guardar</button>
      <button class="btn btn-cancelar" (click)="cancelarEdicionPublicacion()">Cancelar</button>
    </div>
  </div>
</div>

<!-- Modal confirmaciÃ³n eliminaciÃ³n -->
<div class="modal-overlay" *ngIf="confirmVisible">
  <div class="confirm-modal" (click)="$event.stopPropagation()">
    <h3>Confirmar eliminaciÃ³n</h3>
    <p>Â¿EstÃ¡s seguro que deseas eliminar esta publicaciÃ³n? Esta acciÃ³n no se puede deshacer.</p>
    <div class="botones-modal">
      <button class="btn btn-danger" (click)="confirmarEliminar()">SÃ­, eliminar</button>
      <button class="btn" (click)="cancelarEliminar()">Cancelar</button>
    </div>
  </div>
</div>
