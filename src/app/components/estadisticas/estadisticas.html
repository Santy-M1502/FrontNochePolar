<div class="flex">
  <app-side-nav></app-side-nav>
<main class="dashboard-root" role="main">
  <header class="dashboard-header">
    <h1 class="title">Bienvenido {{ (user?.username || '') | capitalize }}</h1>
    <p class="subtitle" *ngIf="user?.perfil">Rol: {{ (user?.perfil || '') | capitalize }}</p>

    <div class="quick-actions" *appHasRole="'admin'">
      <div class="quick-date-buttons">
        <button type="button" (click)="rellenarUltimosDias(30)">Últimos 30 días</button>
        <button type="button" (click)="rellenarUltimosDias(60)">Últimos 60 días</button>
        <button type="button" (click)="rellenarUltimosDias(90)">Últimos 90 días</button>
      </div>
    </div>
  </header>

  <section class="dashboard-grid" aria-label="Panel de estadísticas">

    <article class="card" id="card-posts">
      <header class="card-header">
        <h2>Publicaciones por usuario</h2>
        <div class="card-controls">
          <input type="date" [(ngModel)]="desdePosts" placeholder="Desde">
          <input type="date" [(ngModel)]="hastaPosts" placeholder="Hasta">
          <button type="button" (click)="cargarPosts()">Cargar</button>
          <button type="button" (click)="toggleChartType('posts')">
            Tipo: {{ chartTypes['posts'] | capitalize }}
          </button>
        </div>
      </header>

      <div class="card-body">
        <canvas baseChart
                [data]="postsChartData"
                [labels]="postsChartLabels"
                [type]="chartTypes['posts']"
                [options]="chartOptions">
        </canvas>

        <ul class="summary-list">
          <li *ngFor="let p of postsByUser | slice:0:5">
            {{ p.user | capitalize }} — {{ p.count | humanNumber }}
          </li>
        </ul>
      </div>
    </article>

    <article class="card" id="card-comments-time">
      <header class="card-header">
        <h2>Comentarios (por tiempo)</h2>
        <div class="card-controls">
          <input type="date" [(ngModel)]="desdeComments" placeholder="Desde">
          <input type="date" [(ngModel)]="hastaComments" placeholder="Hasta">
          <button type="button" (click)="cargarComentarios()">Cargar</button>
          <button type="button" (click)="toggleChartType('comments')">
            Tipo: {{ chartTypes['comments'] | capitalize }}
          </button>
        </div>
      </header>

      <div class="card-body">
        <canvas baseChart
                [data]="commentsChartData"
                [labels]="commentsChartLabels"
                [type]="chartTypes['comments']"
                [options]="chartOptions">
        </canvas>

        <div class="small-note">
        </div>
      </div>
    </article>

    <article class="card" id="card-comments-per-post">
      <header class="card-header">
        <h2>Comentarios por publicación</h2>
        <div class="card-controls">
          <input type="date" [(ngModel)]="desdeCommentsPerPost" placeholder="Desde">
          <input type="date" [(ngModel)]="hastaCommentsPerPost" placeholder="Hasta">
          <button type="button" (click)="cargarComentariosPorPost()">Cargar</button>
          <button type="button" (click)="toggleChartType('commentsPerPost')">
            Tipo: {{ chartTypes['commentsPerPost'] | capitalize }}
          </button>
        </div>
      </header>

      <div class="card-body">
        <canvas baseChart
                [data]="commentsPerPostChartData"
                [labels]="commentsPerPostChartLabels"
                [type]="chartTypes['commentsPerPost']"
                [options]="chartOptions">
        </canvas>

        <ol class="post-list">
          <li *ngFor="let p of commentsPerPost | slice:0:6">
            <button type="button" (click)="openPostDetail(p.id)" class="link-like">
              {{ p.postTitle }}
            </button>
            <span class="count">({{ p.count }})</span>
          </li>
        </ol>
      </div>
    </article>

  </section>

  <footer class="dashboard-footer">
    <small>Última actualización: {{ now | relativeTime }}</small>
  </footer>
</main>
<app-chat></app-chat>
</div>