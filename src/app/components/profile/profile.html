<div class="body">
  <app-side-nav></app-side-nav>

  <div class="profile-page">

    <!-- SIDEBAR -->
    <aside class="profile-sidebar">
      <div class="cover-wrap">
        <img class="cover-img" [src]="coverImage" alt="Portada" />
        <label for="cover-input" class="cover-edit">Cambiar portada</label>
        <input id="cover-input" type="file" accept="image/*" style="display:none" (change)="onCoverSelected($event)" />
      </div>

      <div class="avatar-row">
        <div class="avatar-wrap">
          <img class="avatar-img" [src]="user?.profileImage || avatarAnon" alt="Avatar" />
          <label for="avatar-input" class="avatar-edit">游닝</label>
          <input id="avatar-input" type="file" accept="image/*" style="display:none" (change)="onImageSelected($event)" />
        </div>

        <div class="user-basic">
          <h2 class="username">@{{ user?.username || 'usuario' }}</h2>
          <p class="bio">{{ user?.descripcion || 'Sin biograf칤a a칰n' }}</p>
        </div>
      </div>

      <div class="stats">
        <div class="stat">
          <div class="num">{{ posts?.length || 0 }}</div>
          <div class="label">Publicaciones</div>
        </div>
        <div class="stat">
          <div class="num">{{ user?.followers || 0 }}</div>
          <div class="label">Seguidores</div>
        </div>
        <div class="stat">
          <div class="num">{{ user?.following || 0 }}</div>
          <div class="label">Siguiendo</div>
        </div>
      </div>

      <div class="sidebar-actions">
        <button class="btn primary" (click)="editarPerfil()">Editar perfil</button>
        <button class="btn ghost" (click)="logout()">Cerrar sesi칩n</button>
      </div>

      <nav class="sidebar-menu">
        <a class="menu-item" (click)="selectSection('publicaciones')" [class.active]="activeSection==='publicaciones'">Publicaciones {{ posts.length }}</a>
        <a class="menu-item" (click)="selectSection('me-gusta')" [class.active]="activeSection==='me-gusta'">Me gusta {{ likedPosts.length }}</a>
        <a class="menu-item" (click)="selectSection('guardados')" [class.active]="activeSection==='guardados'">Guardados {{ savedPosts.length }}</a>
      </nav>
    </aside>

    <!-- MAIN -->
    <main class="profile-main">
      <div class="tabs">
        <button class="tab" [class.active]="activeSection==='publicaciones'" (click)="selectSection('publicaciones')">Publicaciones</button>
        <button class="tab" [class.active]="activeSection==='me-gusta'" (click)="selectSection('me-gusta')">Me gusta</button>
        <button class="tab" [class.active]="activeSection==='guardados'" (click)="selectSection('guardados')">Guardados</button>
      </div>

      <!-- SECCIONES -->
      <section class="timeline">

        <!-- 游릭 PUBLICACIONES DEL USUARIO -->
        <ng-container *ngIf="activeSection === 'publicaciones'">
          <ng-container *ngIf="posts && posts.length; else noPosts">
            <app-publicacion
              *ngFor="let post of posts | slice:0:visiblePosts"
              [publicacion]="post"
              [usuarioActualId]="usuarioActualId"
              (eliminar)="onPublicacionEliminada($event)">
            </app-publicacion>

            <!-- Bot칩n mostrar m치s -->
            <button 
              *ngIf="visiblePosts < posts.length"
              class="btn show-more"
              (click)="mostrarMas('publicaciones')">
              Mostrar m치s
            </button>
          </ng-container>
        </ng-container>

        <!-- 仇벒잺 ME GUSTA -->
        <ng-container *ngIf="activeSection === 'me-gusta'">
          <ng-container *ngIf="likedPosts && likedPosts.length; else noLikes">
            <app-publicacion
              *ngFor="let post of likedPosts | slice:0:visibleLiked"
              [publicacion]="post"
              [usuarioActualId]="usuarioActualId">
            </app-publicacion>

            <button 
              *ngIf="visibleLiked < likedPosts.length"
              class="btn show-more"
              (click)="mostrarMas('me-gusta')">
              Mostrar m치s
            </button>
          </ng-container>
        </ng-container>

        <!-- 游늷 GUARDADOS -->
        <ng-container *ngIf="activeSection === 'guardados'">
          <ng-container *ngIf="savedPosts && savedPosts.length; else noSaved">
            <app-publicacion
              *ngFor="let post of savedPosts | slice:0:visibleSaved"
              [publicacion]="post"
              [usuarioActualId]="usuarioActualId">
            </app-publicacion>

            <button 
              *ngIf="visibleSaved < savedPosts.length"
              class="btn show-more"
              (click)="mostrarMas('guardados')">
              Mostrar m치s
            </button>
          </ng-container>
        </ng-container>

        <!-- EMPTY STATES -->
        <ng-template #noPosts>
          <div class="empty">No hay publicaciones a칰n.</div>
        </ng-template>
        <ng-template #noLikes>
          <div class="empty">Todav칤a no diste me gusta a ninguna publicaci칩n.</div>
        </ng-template>
        <ng-template #noSaved>
          <div class="empty">No hay publicaciones guardadas.</div>
        </ng-template>

      </section>
    </main>

  </div>

  <app-chat></app-chat>
</div>
